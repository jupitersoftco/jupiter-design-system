# Debugging Rule: Trace Generated Values End-to-End

## Overview
When a system generates values (CSS classes, configuration, HTML), trace them from generation to consumption. Missing links in this chain indicate critical gaps.

## The Tracing Process

### Step 1: Identify Generated Values
```bash
# Run system and capture output
cargo run --example basic_usage 2>&1 | tee full_output.txt

# Extract generated values
grep -o '"[^"]*"' full_output.txt | sort -u > generated_values.txt

# Categorize by type
grep -E "text-|bg-|border-" generated_values.txt > css_classes.txt
grep -E "jupiter-|brand-|custom-" generated_values.txt > custom_values.txt
```

### Step 2: Trace Forward (Where are they used?)
```bash
# For each generated value, find usage
while read value; do
    echo "=== Tracing: $value ==="
    echo "Generated by:"
    grep -r "$value" src --include="*.rs" | head -3
    
    echo "Used in:"
    grep -r "$value" examples --include="*.rs" --include="*.html" | head -3
    
    echo "Defined in:"
    grep -r "$value" . --include="*.css" --include="*.js" --include="*.json" | head -3
    echo
done < custom_values.txt
```

### Step 3: Trace Backward (Where do they come from?)
```bash
# For custom values, find their origin
CUSTOM_PREFIX="jupiter"

# Check 1: Hardcoded in source?
grep -r "\"$CUSTOM_PREFIX-" src --include="*.rs"

# Check 2: Configuration file?
find . -name "*.toml" -o -name "*.json" -o -name "*.yaml" | xargs grep "$CUSTOM_PREFIX"

# Check 3: Build-time generation?
find . -name "build.rs" -o -name "*codegen*" | xargs cat | grep "$CUSTOM_PREFIX"
```

### Step 4: Find the Gap
```bash
# The gap is where the trace breaks
echo "=== Tracing Gap Analysis ==="

# Generated but not defined?
while read class; do
    if ! grep -r "$class" . --include="*.css" --include="*.js" >/dev/null; then
        echo "❌ Generated but not defined: $class"
    fi
done < css_classes.txt

# Expected but not generated?
if [ -f "tailwind.config.js" ]; then
    grep -o "'[^']*'" tailwind.config.js | while read expected; do
        if ! grep "$expected" generated_values.txt >/dev/null; then
            echo "❌ Configured but not generated: $expected"
        fi
    done
fi
```

## Today's Tracing Discovery

### The Chain We Expected
```
Rust Code → CSS Class → Tailwind Config → Generated CSS → Browser
```

### The Broken Chain We Found
```
Rust Code → CSS Class → ❌ (No Tailwind Config) → ❌ (No CSS) → ❌ (No Styling)
```

### Trace Example
```bash
# Value: "text-jupiter-blue-500"

# 1. Generated by:
src/themes/mod.rs: primary: "jupiter-blue-500".to_string()

# 2. Used in:
examples/basic_usage.rs: println!("{}", colors.text_class(Color::Primary))

# 3. Defined in:
❌ NOT FOUND in any CSS or JS file

# Gap: No CSS definition or generation
```

## Tracing Patterns

### Pattern 1: CSS Class Generation
```bash
# Trace CSS class lifecycle
CLASS="text-jupiter-blue-500"

echo "1. Generation:"
grep -r "jupiter-blue-500" src --include="*.rs" -B 2 -A 2

echo "2. Configuration:"
find . -name "tailwind.config.js" -exec grep -H "jupiter-blue" {} \;

echo "3. Build Process:"
grep -r "tailwind\|postcss" package.json 2>/dev/null

echo "4. Output CSS:"
find . -name "*.css" -exec grep -l "$CLASS" {} \;

echo "5. Usage:"
find . -name "*.html" -exec grep -l "$CLASS" {} \;
```

### Pattern 2: Configuration Values
```bash
# Trace config value lifecycle
CONFIG_KEY="primary_color"

echo "1. Default Value:"
grep -r "$CONFIG_KEY" src --include="*.rs" | grep "default\|Default"

echo "2. Override Mechanism:"
grep -r "$CONFIG_KEY" src --include="*.rs" | grep "override\|with_"

echo "3. Serialization:"
grep -r "$CONFIG_KEY" src --include="*.rs" | grep "serialize\|to_json"

echo "4. Documentation:"
grep -r "$CONFIG_KEY" docs --include="*.md"
```

### Pattern 3: Builder Output
```bash
# Trace builder pattern output
BUILDER="ButtonStyles"

echo "1. Builder Methods:"
grep -r "impl $BUILDER" src --include="*.rs" -A 20 | grep "pub fn"

echo "2. Output Generation:"
grep -r "fn build\|fn classes" src --include="*.rs" -A 10 | grep "$BUILDER" -A 10

echo "3. Example Usage:"
grep -r "$BUILDER::new\|$BUILDER {" examples --include="*.rs" -A 5

echo "4. Output Validation:"
# Check if output is actually usable
cargo run --example button_usage | grep -o 'class="[^"]*"' | head -5
```

## Gap Detection Commands

### Find Missing Links
```bash
#!/bin/bash
# find_gaps.sh

echo "=== Checking Generation → Definition Gaps ==="

# Extract all generated CSS classes
find examples -name "*.rs" -exec cargo run --example {} \; 2>/dev/null | 
    grep -o '[a-z-]*-[a-z-]*-[0-9]*' | 
    sort -u > generated_classes.txt

# Check each for definition
while read class; do
    FOUND=$(find . -name "*.css" -o -name "*.js" | xargs grep -l "$class" 2>/dev/null | wc -l)
    if [ $FOUND -eq 0 ]; then
        echo "❌ No definition: $class"
    fi
done < generated_classes.txt

echo "=== Checking Configuration → Generation Gaps ==="

# If Tailwind config exists
if [ -f "tailwind.config.js" ]; then
    # Extract configured colors
    grep -o "'[a-z-]*':" tailwind.config.js | tr -d "':" | while read color; do
        if ! grep -r "$color" src --include="*.rs" >/dev/null; then
            echo "⚠️  Configured but unused: $color"
        fi
    done
fi
```

### Visual Trace Diagram
```bash
# Create visual trace
cat > trace_diagram.md << 'EOF'
# Value Trace: text-jupiter-blue-500

## Generation Path
```
src/themes/mod.rs
    ↓ (ColorPalette.primary = "jupiter-blue-500")
src/core/color.rs
    ↓ (text_class() → format!("text-{}"))
examples/basic_usage.rs
    ↓ (prints: "text-jupiter-blue-500")
❌ BREAK: No CSS Definition
    ↓
tailwind.config.js (MISSING)
    ↓
generated.css (MISSING)
    ↓
Browser (NO STYLING)
```
EOF
```

## Key Insights

### Complete Trace Requirements
1. **Generation** - Where value is created
2. **Configuration** - Where value is defined
3. **Build Process** - How definition becomes usable
4. **Consumption** - Where value is used
5. **Validation** - Proof it works

### Today's Broken Traces
- `jupiter-blue-500` → No Tailwind config
- `ring-jupiter-blue-300` → No CSS definition
- `from-jupiter-navy-900` → No gradient definition
- All custom values → No build process

## The Rule

**Every generated value must have a complete trace from generation to consumption.**

If any link is missing:
1. Document the gap prominently
2. Provide setup instructions
3. Consider if the system is usable
4. Fix before extensive documentation

Time to trace values: **15 minutes**
Time wasted documenting broken system: **2+ hours**